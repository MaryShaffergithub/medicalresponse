Data exchange with STATA:

1. There is a wrapper STATA function that calls R as below:

shell Rscript --vanilla PATH_TO_ADHERER/callAdhereR.R PATH_TO_WHERE_DATA_AND_RESULTS_ARE

and packs the necessary info in:

- current dataset as "dataset.csv" (TAB-separated, no quotes)

- parameters file as "parameters.log" in the format exemplified below:

Parameters
function="CMA1"
ID.colname="id"
event.date.colname="fecha_pres"
event.duration.colname="diascub"
event.daily.dose.colname="posologia"
medication.class.colname=""
end_parameters


2. R will return in the same folder the following files:

- "Adherer-results.txt": contains "OK" if everything fine, otherwise a message error (probably to be displayed to the user)

- "CMA.csv": a TAB-separated (no quotes) CSV file containing the resulting CMAs

- "EVENTINFO.csv": a TAB-separated (no quotes) CSV file containing the internally computed event info and gap days -- only be explicit request


TODO:
- plots


--------


PARAMETERS (some are required and must be defined, but for most we can use implicit values -- i.e., if the user doesn't give them explicitly, simply don't write them to the parameters.log file and I will use the default values in AdhereR)



COMMENTS:
everything on a line following /// or # is considered a comment and ignored (except when included within "" or '')



SPECIAL PARAMETERS:

NA.SYMBOL.NUMERIC    <-- the numeric missing data symbol; if missing, defaults to NA (STATA: ".")
NA.SYMBOL.STRING     <-- the string missing data symbol; if missing, defaults to NA (STATA: "")
LOGICAL.SYMBOL.TRUE  <-- the logical TRUE symbol; if missing, defaults to TRUE (STATA: "1")
LOGICAL.SYMBOL.FALSE <-- the logical FALSE symbol; if missing, defaults to FALSE (STATA: "0")
COLNAMES.DOT.SYMBOL  <-- can use "." in column names, and if not, what to replace it with, defaults to "." (STATA: "_")
COLNAMES.START.DOT   <-- can begin column names with "." (or equivalent symbol), and if not, what to replace it with, defaults to "." (STATA: "internal_")




FUNCTIONS: CMA1...CMA9, CMA_per_episode, CMA_sliding_window, compute.event.int.gaps, compute.treatment.episodes, plot_interactive_cma

++ PLOTTING: all functions can also specify parameters related to plotting (a subset) of the patients:
PARAMETER				REQUIRED	DEFAULT_VALUE	POSSIBLE_VALUES
plot.show				NO		FALSE		[do the plotting? If TRUE, save the resulting dataset with a "-plotted" suffix to avoid overwriting previous results]
plot.save.to				NO		""		[the folder where to save the plots (by default, same folder as the results)]
plot.save.as				NO		"jpg"		"jpg", "png", "tiff", "eps", "pdf" [the type of image to save]
plot.width				NO		"7"		[plot width in inches]
plot.height				NO		"7"		[plot height in inches]
plot.quality				NO		"90"		[plot quality (applies only to some types of plots]
plot.dpi				NO		"150"		[plot DPI (applies only to some types of plots]
plot.patients.to.plot			NO		""		[the patient IDs to plot (if missing, all patients) given as "id1;id2; .. ;idn"]
plot.duration				NO		""		[duration to plot in days (if missing, determined from the data)]
plot.align.all.patients			NO		FALSE 		[should all patients be aligned? and, if so, place the first event as the horizontal 0?]
plot.align.first.event.at.zero		NO		TRUE
plot.show.period			NO		"days"		"dates", "days"  [draw vertical bars at regular interval as dates or days?]
plot.period.in.days			NO		90,             [the interval (in days) at which to draw vertical lines]
plot.show.legend			NO		TRUE		[legend params and position]
plot.legend.x				NO		"bottom right"
plot.legend.y				NO		""
plot.legend.bkg.opacity			NO		0.5 		[background opacity]
plot.cex				NO		1.0		[various plotting font sizes]
plot.cex.axis				NO		0.75
plot.cex.lab				NO		1.0
plot.show.cma				NO		TRUE		[show the CMA type]
plot.unspecified.category.label		NO		"drug"		[the label of the unspecified category of medication]
plot.lty.event				NO		"solid"		[style parameters controlling the plotting of events]
plot.lwd.event				NO		2
plot.pch.start.event			NO		15
plot.pch.end.event			NO		16
plot.show.event.intervals		NO		TRUE		[show the actual prescription intervals]
plot.col.na				NO		"lightgray"	[color for missing data]
plot.col.continuation			NO		"black"		[style of the continuation lines connecting consecutive events]
plot.lty.continuation			NO		"dotted"
plot.lwd.continuation			NO		1
plot.print.CMA				NO		TRUE		[print CMA next to the participant's ID?]
plot.plot.CMA				NO		TRUE		[plot the CMA next to the participant ID?]
plot.plot.CMA.as.histogram		NO		TRUE		[lot CMA as a histogram or as a density plot?]
plot.CMA.plot.ratio			NO		0.10		[the proportion of the total horizontal plot to be taken by the CMA plot]
plot.CMA.plot.col			NO		"lightgreen"	[attributes of the CMA plot]
plot.CMA.plot.border			NO		"darkgreen"
plot.CMA.plot.bkg			NO		"aquamarine"
plot.CMA.plot.text			NO		""		[by default, the same as plot.CMA.plot.border] 
plot.highlight.followup.window		NO		TRUE
plot.followup.window.col		NO		"green"
plot.highlight.observation.window	NO		TRUE
plot.observation.window.col		NO		"yellow"
plot.observation.window.density		NO		35
plot.observation.window.angle		NO		-30
plot.show.real.obs.window.start		NO		TRUE		[for some CMAs, the real observation window starts at a different date]
plot.real.obs.window.density		NO		35
plot.real.obs.window.angle		NO		30 
plot.bw.plot				NO		FALSE		[if TRUE, override all user-given colors and replace them with a scheme suitable for grayscale plotting]



++ CMA1, CMA2, CMA3, CMA4:

PARAMETER				REQUIRED	DEFAULT_VALUE	POSSIBLE_VALUES
ID.colname				YES 
event.date.colname			YES
event.duration.colname			YES
followup.window.start.type		NO		numeric		numeric, character, date
followup.window.start			NO		0
followup.window.start.unit 		NO		days		days, weeks, months, years
followup.window.duration.type		NO		numeric		numeric, character, date
followup.window.duration 		NO		365 * 2		
followup.window.duration.unit 		NO		days		days, weeks, months, years
observation.window.start.type		NO		numeric		numeric, character, date
observation.window.start		NO		0
observation.window.start.unit 		NO		days		days, weeks, months, years
observation.window.duration.type	NO		numeric		numeric, character, date
observation.window.duration 		NO		365 * 2		
observation.window.duration.unit 	NO		days		days, weeks, months, years
date.format				NO		%m/%d/%Y
event.interval.colname			NO		event.interval
gap.days.colname			NO		gap.days
force.NA.CMA.for.failed.patients	NO		TRUE
parallel.backend			NO		none		none, multicore, snow, snow(SOCK), snow(MPI), snow(NWS)
parallel.threads			NO		auto		[[this is a bit complicated, we'll detail in the help file]]
suppress.warnings			NO		FALSE
save.event.info				NO		FALSE

RETURN VALUES
Adherer-results.txt   <-- "OK" or error messages (if any)
CMA.csv       <-- the CMAs (one per patient), always exported
EVENTINFO.csv <-- the gap days and event info data (by explicit request only)



++ CMA5, CMA6, CMA7, CMA8, CMA9:

PARAMETER				REQUIRED	DEFAULT_VALUE	POSSIBLE_VALUES
ID.colname				YES 
event.date.colname			YES
event.duration.colname			YES
event.daily.dose.colname		YES
medication.class.colname		YES
carry.only.for.same.medication		NO		FALSE
consider.dosage.change			NO		FALSE
followup.window.start.type		NO		numeric		numeric, character, date
followup.window.start			NO		0
followup.window.start.unit 		NO		days		days, weeks, months, years
followup.window.duration.type		NO		numeric		numeric, character, date
followup.window.duration 		NO		365 * 2		
followup.window.duration.unit 		NO		days		days, weeks, months, years
observation.window.start.type		NO		numeric		numeric, character, date
observation.window.start		NO		0
observation.window.start.unit 		NO		days		days, weeks, months, years
observation.window.duration.type	NO		numeric		numeric, character, date
observation.window.duration 		NO		365 * 2		
observation.window.duration.unit 	NO		days		days, weeks, months, years
date.format				NO		%m/%d/%Y
event.interval.colname			NO		event.interval
gap.days.colname			NO		gap.days
force.NA.CMA.for.failed.patients	NO		TRUE
parallel.backend			NO		none		none, multicore, snow, snow(SOCK), snow(MPI), snow(NWS)
parallel.threads			NO		auto		[[this is a bit complicated, we'll detail in the help file]]
suppress.warnings			NO		FALSE
save.event.info				NO		FALSE

RETURN VALUES
Adherer-results.txt   <-- "OK" or error messages (if any)
CMA.csv       <-- the CMAs (one per patient), always exported
EVENTINFO.csv <-- the gap days and event info data (by explicit request only)



++ CMA_per_episode:

PARAMETER					REQUIRED	DEFAULT_VALUE	POSSIBLE_VALUES
CMA.to.apply					YES
ID.colname					YES 
event.date.colname				YES
event.duration.colname				YES
event.daily.dose.colname			YES
medication.class.colname			YES
carry.only.for.same.medication			NO		FALSE
consider.dosage.change				NO		FALSE
medication.change.means.new.treatment.episode	NO		TRUE
maximum.permissible.gap				NO		180
maximum.permissible.gap.unit			NO		days		days, weeks, months, years, percent
followup.window.start.type			NO		numeric		numeric, character, date
followup.window.start				NO		0
followup.window.start.unit 			NO		days		days, weeks, months, years
followup.window.duration.type			NO		numeric		numeric, character, date
followup.window.duration 			NO		365 * 2		
followup.window.duration.unit 			NO		days		days, weeks, months, years
observation.window.start.type			NO		numeric		numeric, character, date
observation.window.start			NO		0
observation.window.start.unit 			NO		days		days, weeks, months, years
observation.window.duration.type		NO		numeric		numeric, character, date
observation.window.duration 			NO		365 * 2		
observation.window.duration.unit 		NO		days		days, weeks, months, years
date.format					NO		%m/%d/%Y
event.interval.colname				NO		event.interval
gap.days.colname				NO		gap.days
force.NA.CMA.for.failed.patients		NO		TRUE
parallel.backend				NO		none		none, multicore, snow, snow(SOCK), snow(MPI), snow(NWS)
parallel.threads				NO		auto		[[this is a bit complicated, we'll detail in the help file]]
suppress.warnings				NO		FALSE
save.event.info					NO		FALSE

RETURN VALUES
Adherer-results.txt   <-- "OK" or error messages (if any)
CMA.csv       <-- the CMAs (one per patient), always exported
EVENTINFO.csv <-- the gap days and event info data (by explicit request only)



++ CMA_sliding_window:

PARAMETER					REQUIRED	DEFAULT_VALUE	POSSIBLE_VALUES
CMA.to.apply					YES
ID.colname					YES 
event.date.colname				YES
event.duration.colname				YES
event.daily.dose.colname			YES
medication.class.colname			YES
carry.only.for.same.medication			NO		FALSE
consider.dosage.change				NO		FALSE
followup.window.start.type			NO		numeric		numeric, character, date
followup.window.start				NO		0
followup.window.start.unit 			NO		days		days, weeks, months, years
followup.window.duration.type			NO		numeric		numeric, character, date
followup.window.duration 			NO		365 * 2		
followup.window.duration.unit 			NO		days		days, weeks, months, years
observation.window.start.type			NO		numeric		numeric, character, date
observation.window.start			NO		0
observation.window.start.unit 			NO		days		days, weeks, months, years
observation.window.duration.type		NO		numeric		numeric, character, date
observation.window.duration 			NO		365 * 2		
observation.window.duration.unit 		NO		days		days, weeks, months, years
sliding.window.start.type			NO		numeric		numeric, character, date
sliding.window.start				NO		0
sliding.window.start.unit 			NO		days		days, weeks, months, years
sliding.window.duration.type			NO		numeric		numeric, character, date
sliding.window.duration 			NO		90		
sliding.window.duration.unit 			NO		days		days, weeks, months, years
sliding.window.step.duration.type		NO		numeric		numeric, character
sliding.window.step.duration			NO		30		
sliding.window.step.unit			NO		days		days, weeks, months, years
sliding.window.no.steps				NO		-1
date.format					NO		%m/%d/%Y
event.interval.colname				NO		event.interval
gap.days.colname				NO		gap.days
force.NA.CMA.for.failed.patients		NO		TRUE
parallel.backend				NO		none		none, multicore, snow, snow(SOCK), snow(MPI), snow(NWS)
parallel.threads				NO		auto		[[this is a bit complicated, we'll detail in the help file]]
suppress.warnings				NO		FALSE
save.event.info					NO		FALSE

RETURN VALUES
Adherer-results.txt   <-- "OK" or error messages (if any)
CMA.csv       <-- the CMAs (one per patient), always exported
EVENTINFO.csv <-- the gap days and event info data (by explicit request only)


++ compute_event_int_gaps:

PARAMETER					REQUIRED	DEFAULT_VALUE	POSSIBLE_VALUES
ID.colname					YES 
event.date.colname				YES
event.duration.colname				YES
event.daily.dose.colname			NO
medication.class.colname			NO
carryover.within.obs.window			NO		FALSE
carryover.into.obs.window			NO		FALSE
carry.only.for.same.medication			NO		FALSE
consider.dosage.change				NO		FALSE
followup.window.start.type			NO		numeric		numeric, character, date
followup.window.start				NO		0
followup.window.start.unit 			NO		days		days, weeks, months, years
followup.window.duration.type			NO		numeric		numeric, character, date
followup.window.duration 			NO		365 * 2		
followup.window.duration.unit 			NO		days		days, weeks, months, years
observation.window.start.type			NO		numeric		numeric, character, date
observation.window.start			NO		0
observation.window.start.unit 			NO		days		days, weeks, months, years
observation.window.duration.type		NO		numeric		numeric, character, date
observation.window.duration 			NO		365 * 2		
observation.window.duration.unit 		NO		days		days, weeks, months, years
date.format					NO		%m/%d/%Y
keep.window.start.end.dates			NO		FALSE
remove.events.outside.followup.window		NO		TRUE
keep.event.interval.for.all.events		NO		FALSE
event.interval.colname				NO		event.interval
gap.days.colname				NO		gap.days
force.NA.CMA.for.failed.patients		NO		TRUE
parallel.backend				NO		none		none, multicore, snow, snow(SOCK), snow(MPI), snow(NWS)
parallel.threads				NO		auto		[[this is a bit complicated, we'll detail in the help file]]
suppress.warnings				NO		FALSE

RETURN VALUES
Adherer-results.txt   <-- "OK" or error messages (if any)
EVENTINFO.csv <-- the gap days and event info data (always)


++ compute_treatment_episodes:

PARAMETER					REQUIRED	DEFAULT_VALUE	POSSIBLE_VALUES
ID.colname					YES 
event.date.colname				YES
event.duration.colname				YES
event.daily.dose.colname			NO
medication.class.colname			NO
carryover.within.obs.window			NO		FALSE
carryover.into.obs.window			NO		FALSE
carry.only.for.same.medication			NO		FALSE
consider.dosage.change				NO		FALSE
medication.change.means.new.treatment.episode	NO		FALSE
maximum.permissible.gap				NO		90
maximum.permissible.gap.unit			NO		days		days, weeks, months, years, percent
followup.window.start.type			NO		numeric		numeric, character, date
followup.window.start				NO		0
followup.window.start.unit 			NO		days		days, weeks, months, years
followup.window.duration.type			NO		numeric		numeric, character, date
followup.window.duration 			NO		365 * 2		
followup.window.duration.unit 			NO		days		days, weeks, months, years
observation.window.start.type			NO		numeric		numeric, character, date
observation.window.start			NO		0
observation.window.start.unit 			NO		days		days, weeks, months, years
observation.window.duration.type		NO		numeric		numeric, character, date
observation.window.duration 			NO		365 * 2		
observation.window.duration.unit 		NO		days		days, weeks, months, years
date.format					NO		%m/%d/%Y
keep.window.start.end.dates			NO		FALSE
remove.events.outside.followup.window		NO		TRUE
keep.event.interval.for.all.events		NO		FALSE
event.interval.colname				NO		event.interval
gap.days.colname				NO		gap.days
force.NA.CMA.for.failed.patients		NO		TRUE
parallel.backend				NO		none		none, multicore, snow, snow(SOCK), snow(MPI), snow(NWS)
parallel.threads				NO		auto		[[this is a bit complicated, we'll detail in the help file]]
suppress.warnings				NO		FALSE

RETURN VALUES
Adherer-results.txt   <-- "OK" or error messages (if any)
TREATMENTEPISODES.csv <-- the treatment episodes data (always)



++ plot_interactive_cma:	<--- this ignores plot.show=TRUE !

PARAMETER					REQUIRED	DEFAULT_VALUE	POSSIBLE_VALUES
patient_to_plot					NO		[first patient in the data]
ID.colname					YES 
event.date.colname				YES
event.duration.colname				YES
event.daily.dose.colname			NO
medication.class.colname			NO
date.format					NO		%m/%d/%Y
followup.window.start.max			NO		
followup.window.duration.max			NO		
observation.window.start.max			NO		
observation.window.duration.max			NO	
maximum.permissible.gap.max			NO
sliding.window.start.max			NO
sliding.window.duration.max			NO
sliding.window.step.duration.max		NO




